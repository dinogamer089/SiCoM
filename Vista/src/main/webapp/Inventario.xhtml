<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>

<html  xmlns="http://www.w3.org/1999/xhtml"
       xmlns:h="http://xmlns.jcp.org/jsf/html"
       xmlns:f="http://xmlns.jcp.org/jsf/core"
       xmlns:p="http://primefaces.org/ui"
       xml:lang="es" lang="es">

<h:head>
    <title>Gestion de Articulos</title>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style type="text/css">
        @font-face {
            font-family: "Minerva Modern";
            src: url("resources/MinervaModern_Bold.ttf") format("truetype");
            font-weight: bold;
            font-style: normal;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            background: #E7D9CB;
        }

        .topbar {
            background-color: #3D4435;
            color: #C2C8CC;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
        }
        .topbar-left, .topbar-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .topbar-center {
            text-align: center;
            flex-grow: 1;
            font-style: italic;
            font-size: 22px;
        }
        .topbar a {
            text-decoration: none;
            color: #C2C8CC;
            font-size: 16px;
            margin: 0 5px;
            font-style: italic;
        }
        .topbar a:hover {
            text-decoration: underline;
        }
        .topbar img {
            width: 20px;
            height: 20px;
        }
        .content {
            padding: 20px 60px;
            font-family: 'Minerva Modern', serif;
        }

        .title {
            font-size: 26px;
            margin-bottom: 20px;
            color: #000000;
        }

        .button-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .btn {
            background-color: black;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 15px;
            cursor: pointer;
            transition: 0.2s;
            font-family: 'Minerva Modern', serif;
        }

        .btn:hover {
            background-color: #444;
        }

        .table-container {
            background-color: white;
            border: 1px solid #ccc;
            max-height: 350px;
            overflow-y: auto;
            border-radius: 5px;
        }

        .ui-datatable thead th,
        .inventory-table thead th {
            background-color: black !important;
            color: white !important;
            text-align: center !important;
            font-weight: bold !important;
        }

        .ui-datatable tbody td,
        .inventory-table tbody td {
            color: black !important;
            font-weight: bold !important;
            text-align: center !important;
            padding: 8px !important;
        }

        .ui-datatable tbody tr:nth-child(even),
        .inventory-table tbody tr:nth-child(even) {
            background-color: #6b7c6b !important;
            color: white !important;
        }

        .ui-datatable tbody tr:nth-child(odd),
        .inventory-table tbody tr:nth-child(odd) {
            background-color: #e9e9e9 !important;
            color: black !important;
        }

        .ui-datatable .ui-state-highlight,
        .ui-datatable .ui-state-highlight td,
        .inventory-table .ui-state-highlight td {
            background-color: #b7e6b3 !important;
        }

        .ui-dialog {
            font-family: 'Minerva Modern', serif !important;
        }

        .ui-dialog .ui-dialog-titlebar {
            background-color: #3D4435 !important;
            color: white !important;
            border: none !important;
            padding: 15px !important;
        }

        .ui-dialog .ui-dialog-title {
            font-size: 18px !important;
            font-weight: bold !important;
        }

        .ui-dialog .ui-dialog-content {
            background-color: #E7D9CB !important;
            padding: 20px !important;
        }

        .ui-dialog .ui-dialog-footer {
            background-color: #E7D9CB !important;
            border-top: 1px solid #ccc !important;
            padding: 15px !important;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 15px;
            align-items: center;
        }

        .form-grid label {
            font-weight: bold;
            text-align: right;
            color: #333;
        }

        .form-grid input,
        .form-grid .ui-inputnumber,
        .form-grid .ui-fileupload {
            width: 100%;
        }

        .form-grid .ui-inputnumber-input {
            width: 100%;
        }

        .ui-fileupload-simple {
            background-color: white !important;
            border: 1px solid #ccc !important;
            padding: 8px !important;
        }

        .ui-fileupload-choose {
            background-color: black !important;
            color: white !important;
            border: none !important;
            padding: 8px 15px !important;
            cursor: pointer !important;
        }

        .ui-fileupload-choose:hover {
            background-color: #444 !important;
        }
    </style>
</h:head>
<h:body>
    <div class="topbar">
        <div class="topbar-left">
            <img src="resources/edicion.png" alt="Empleados" class="topbar-icon" />
            <a href="AdminEmpleados.xhtml">Empleados</a>
        </div>
        <div class="topbar-center">
            <a href="#"> EVENTOS CAMPESTRE</a><br />
            <a href="#">Inventario</a>
            <a href="#">ArtÃ­culos</a>
            <a href="#">Cotizaciones</a>
            <a href="#">Rentas</a>
        </div>
        <div class="topbar-right">
            <span>Administrador</span>
            <img src="resources/administrador.png" alt="admin" class="topbar-icon" />
        </div>
    </div>

    <div class="content">
        <h1 class="title">Inventario</h1>

        <h:form id="articulosForm">
            <p:growl id="messages" showDetail="true" life="3000"/>

            <div class="button-bar">
                <p:commandButton value="+ Alta"
                                 style="background-color:black;color:white;border:none;padding:10px 20px;font-size:15px;cursor:pointer;font-family:'Minerva Modern',serif;"
                                 onclick="PF('dialogAlta').show();"
                                 actionListener="#{articuloUI.prepararNuevoArticulo()}"
                                 update=":dialogForm:dialogPanel"
                                 type="button"/>
                <p:commandButton value="âœŽ Modificar"
                                 style="background-color:black;color:white;border:none;padding:10px 20px;font-size:15px;cursor:pointer;font-family:'Minerva Modern',serif;"
                                 oncomplete="PF('editDialogWV').show();"
                                 update=":editDialog"/>
                <button class="btn eliminar" type="button" disabled="disabled">ðŸ—‘ Eliminar</button>
            </div>

            <p:dataTable value="#{articuloUI.articulos}" var="art"
                         id="tablaArticulos"
                         selection="#{articuloUI.seleccionada}"
                         selectionMode="single"
                         rowKey="#{art.idarticulo}"
                         styleClass="inventory-table"
                         style="width:100%;">

                <p:ajax event="rowSelect" listener="#{articuloUI.seleccionar(articuloUI.seleccionada)}" update="@form" />

                <p:column headerText="ID">#{art.idarticulo}</p:column>
                <p:column headerText="Nombre">#{art.nombre}</p:column>
                <p:column headerText="Cantidad">#{art.cantidad}</p:column>
                <p:column headerText="Precio">#{art.precio}$</p:column>
                <p:column headerText="Tipo">#{art.tipo}</p:column>
                <p:column headerText="ImÃ¡genes">
                    <h:panelGroup rendered="#{art.imagen != null and art.imagen.length > 0}">
                        <h:graphicImage value="#{articuloUI.getImagenBase64(art.imagen)}"
                                        width="40"
                                        height="40"
                                        style="object-fit: cover;"/>
                    </h:panelGroup>
                    <h:outputText value="Sin imagen"
                                  rendered="#{art.imagen == null or art.imagen.length == 0}"
                                  style="color: gray; font-style: italic;"/>
                </p:column>
            </p:dataTable>
        </h:form>

        <h:form id="dialogForm" enctype="multipart/form-data">
            <p:dialog header="Nuevo ArtÃ­culo"
                      widgetVar="dialogAlta"
                      modal="true"
                      width="500"
                      resizable="false">

                <p:outputPanel id="dialogPanel">
                    <div class="form-grid">
                        <h:outputLabel value="Nombre:" for="nombre"/>
                        <p:inputText id="nombre"
                                     value="#{articuloUI.nuevoArticulo.nombre}"
                                     required="true"
                                     requiredMessage="El nombre es obligatorio"/>

                        <h:outputLabel value="Cantidad:" for="cantidad"/>
                        <p:inputNumber id="cantidad"
                                       value="#{articuloUI.nuevoArticulo.cantidad}"
                                       decimalPlaces="0"
                                       required="true"
                                       requiredMessage="La cantidad es obligatoria"/>

                        <h:outputLabel value="Precio:" for="precio"/>
                        <p:inputNumber id="precio"
                                       value="#{articuloUI.nuevoArticulo.precio}"
                                       decimalPlaces="0"
                                       required="true"
                                       requiredMessage="El precio es obligatorio"/>

                        <h:outputLabel value="Tipo:" for="tipo"/>
                        <p:inputText id="tipo"
                                     value="#{articuloUI.nuevoArticulo.tipo}"
                                     required="true"
                                     requiredMessage="El tipo es obligatorio"/>

                        <h:outputLabel value="Imagen:" for="imagen"/>
                        <p:fileUpload id="imagen"
                                      value="#{articuloUI.imagenFile}"
                                      mode="simple"
                                      skinSimple="true"
                                      label="Seleccionar..."
                                      accept="image/*"/>
                    </div>
                </p:outputPanel>

                <f:facet name="footer">
                    <p:commandButton value="Guardar"
                                     action="#{articuloUI.guardarArticulo()}"
                                     ajax="false"
                                     process="@form"
                                     styleClass="btn"
                                     style="margin-right: 10px;"/>

                    <p:commandButton value="Cancelar"
                                     onclick="PF('dialogAlta').hide();"
                                     type="button"
                                     styleClass="btn"/>
                </f:facet>
            </p:dialog>
        </h:form>
        <p:dialog id="editDialog"
                  widgetVar="editDialogWV"
                  header="Modificar artÃ­culo"
                  modal="true"
                  appendTo="@(body)"
                  closable="false"
                  resizable="false"
                  draggable="false"
                  style="background-color:#3D4435;color:white;border:none;width:400px;">
            <h:form id="editForm" enctype="multipart/form-data">
                <h:panelGrid columns="2" cellpadding="5">
                    <h:outputLabel for="nombre" value="Nombre" />
                    <p:inputText id="nombre" value="#{articuloUI.seleccionada.nombre}" style="width:180px;" />

                    <h:outputLabel for="precio" value="Precio" />
                    <p:inputText id="precio" value="#{articuloUI.seleccionada.precio}" style="width:180px;" />

                    <h:outputLabel for="cantidad" value="Cantidad" />
                    <p:inputText id="cantidad" value="#{articuloUI.seleccionada.cantidad}" style="width:180px;" />

                    <h:outputLabel for="tipo" value="Tipo" />
                    <p:inputText id="tipo" value="#{articuloUI.seleccionada.tipo}" style="width:180px;" />

                    <h:outputLabel for="imagen" value="Imagen" />
                    <h:inputFile id="imagen" value="#{articuloUI.imagenFile}" />
                </h:panelGrid>

                <p:commandButton value="Cancelar"
                                 type="button"
                                 style="background-color:black;color:white;"
                                 onclick="PF('editDialogWV').hide();" />

                <p:commandButton value="Listo"
                                 style="background-color:black;color:white;"
                                 actionListener="#{articuloUI.actualizarArticulo}"
                                 update=":articulosForm"
                                 ajax="false"
                                 oncomplete="PF('editDialogWV').hide();" />
            </h:form>
        </p:dialog>
    </div>
</h:body>
</html>