<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xml:lang="es" lang="es">

<f:metadata>
    <f:event type="preRenderView" listener="#{loginUI.preventBackAfterLogout}" />
</f:metadata>

<h:head>
    <title>Tarjeta de Almacen</title>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style type="text/css">
        @font-face {
            font-family: "Minerva Modern";
            src: url("resources/MinervaModern_Bold.ttf") format("truetype");
            font-weight: bold;
            font-style: normal;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: #E7D9CB;
            font-family: "FreightText Pro", serif;
        }

        /* ---------- TOPBAR ---------- */
        .topbar {
            background-color: #3D4435;
            color: #C2C8CC;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
        }
        .topbar-left, .topbar-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .topbar-center {
            text-align: center;
            flex-grow: 1;
            font-style: italic;
            font-size: 22px;
        }
        .topbar a {
            text-decoration: none;
            color: #C2C8CC;
            font-size: 16px;
            margin: 0 5px;
            font-style: italic;
        }
        .topbar a:hover {
            text-decoration: underline;
        }
        .topbar img,
        .topbar .topbar-icon {
            width: 20px;
            height: 20px;
        }

        /* ---------- CONTENIDO ---------- */
        .content {
            padding: 30px 60px;
        }
        .title {
            font-family: "Minerva Modern", serif;
            font-size: 1.6em;
            margin: 0 0 20px 0;
        }

        .filter-panel {
            background-color: white;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .filter-panel h3 {
            margin: 0 0 20px 0;
            font-family: "Minerva Modern", serif;
            font-size: 1.3em;
            color: #3D4435;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            gap: 20px;
            align-items: flex-end;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-row-inline {
            display: flex;
            gap: 20px;
            align-items: flex-end;
            flex-wrap: wrap;
            flex: 1;
        }

        .filter-field {
            display: flex;
            flex-direction: column;
            min-width: 200px;
            position: relative;
        }

        .filter-field label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #3D4435;
            font-size: 0.95em;
        }

        .filter-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .btn {
            background-color: #000000 !important;
            color: #FFFFFF !important;
            font-family: "FreightText Pro", serif;
            border: none !important;
            padding: 10px 25px !important;
            cursor: pointer;
            font-size: 1em !important;
            transition: 0.2s;
            border-radius: 0 !important;
        }
        .btn:hover {
            opacity: 0.8;
        }

        .table-container {
            background-color: transparent;
            border: none;
            max-height: 500px;
            overflow-y: auto;
            border-radius: 0 0 8px 8px;
            padding: 5px 0;
        }

        .tarjeta-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 25px;
        }

        .tarjeta-table thead {
            display: table-header-group;
        }

        .tarjeta-table thead th {
            background-color: #3D4435;
            color: #FFFFFF;
            padding: 15px 16px;
            text-align: left;
            font-size: 0.95em;
            font-weight: 600;
            border: none;
        }

        .tarjeta-table thead th:first-child {
            padding-left: 24px;
        }

        .tarjeta-table thead th:last-child {
            padding-right: 24px;
        }

        .tarjeta-table tbody td {
            background-color: #C2C8CC;
            text-align: left;
            padding: 20px 16px;
            border: none;
            border-left: none;
            border-right: none;
            font-size: 1em;
            color: #000000;
            vertical-align: middle;
            box-shadow: none;
            line-height: 1.5;
        }

        .tarjeta-table tbody td:not(:first-child) {
            border-left: none;
        }

        .tarjeta-table tbody tr {
            box-shadow: none;
            background-color: #C2C8CC;
        }

        .tarjeta-table tbody tr td:first-child {
            border-radius: 0;
            padding-left: 24px;
            border-right: 0;
        }

        .tarjeta-table tbody tr td:last-child {
            border-radius: 0;
            padding-right: 24px;
            border-left: 0;
        }

        /* Eliminar cualquier espacio entre celdas */
        .tarjeta-table tbody tr td {
            margin: 0;
            border-spacing: 0;
        }

        .tarjeta-table tbody tr:hover {
            transform: none;
            transition: all 0.2s ease;
        }

        .tarjeta-table tbody tr:hover td {
            background-color: #B5BCC2;
            cursor: pointer;
            box-shadow: none;
        }


        /* Estilos para columnas específicas */
        .tarjeta-table tbody td:nth-child(1) {
            width: 60px;
            font-weight: 600;
        }

        .tarjeta-table tbody td:nth-child(4),
        .tarjeta-table tbody td:nth-child(5),
        .tarjeta-table tbody td:nth-child(6),
        .tarjeta-table tbody td:nth-child(7) {
            text-align: center;
            font-variant-numeric: tabular-nums;
        }

        .tarjeta-table tbody td:nth-child(8),
        .tarjeta-table tbody td:nth-child(9),
        .tarjeta-table tbody td:nth-child(10) {
            text-align: right;
            font-variant-numeric: tabular-nums;
        }

        .tarjeta-header {
            background-color: transparent;
            color: #3D4435;
            padding: 20px 0;
            margin-bottom: 15px;
            border-radius: 0;
            text-align: left;
            box-shadow: none;
            border-bottom: 2px solid #C2C8CC;
        }

        .tarjeta-header h3 {
            margin: 0;
            font-family: "Minerva Modern", serif;
            font-size: 1.6em;
            letter-spacing: 0.5px;
            font-weight: bold;
        }

        /* Contenedor integrado */
        h:panelGroup {
            display: block;
        }

        /* Mensaje de tabla vacía */
        .empty-table-message {
            background-color: #F5EEE6;
            padding: 40px;
            text-align: center;
            color: #8B7355;
            font-style: italic;
            border-radius: 8px;
            border: 2px dashed #D4C4B0;
        }


        .ui-inputfield, .ui-selectonemenu {
            width: 100%;
        }

        /* Mensajes de advertencia en rojo */
        .ui-messages-warn,
        .ui-message-warn {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            color: #721c24 !important;
        }

        .ui-messages-warn .ui-messages-warn-icon,
        .ui-message-warn .ui-message-warn-icon {
            color: #dc3545 !important;
        }

        .ui-messages-warn .ui-messages-warn-summary,
        .ui-message-warn .ui-message-warn-summary {
            color: #721c24 !important;
            font-weight: bold;
        }

        .ui-messages-warn .ui-messages-warn-detail,
        .ui-message-warn .ui-message-warn-detail {
            color: #721c24 !important;
        }

        .amount-positive {
            color: #000000;
            font-weight: normal;
        }

        .amount-negative {
            color: #000000;
            font-weight: normal;
        }

        .toggle-buttons {
            display: flex;
            gap: 0;
            margin-bottom: 25px;
            border: 2px solid #000000;
            border-radius: 4px;
            overflow: hidden;
            width: fit-content;
        }

        .toggle-buttons .btn {
            border-radius: 0 !important;
            margin: 0 !important;
            border: none !important;
            background-color: #ffffff !important;
            color: #000000 !important;
        }

        .toggle-buttons .btn:hover {
            background-color: #f5f5f5 !important;
        }

        .toggle-buttons .btn:disabled {
            background-color: #000000 !important;
            color: #ffffff !important;
            opacity: 1 !important;
            cursor: default;
        }

        /* Estilos mínimos para el calendario */
        .filter-field .ui-calendar {
            width: 100%;
            position: relative;
        }

        /* Botón del calendario a la derecha */
        .filter-field .ui-datepicker-trigger {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }

        .filter-field .ui-calendar .ui-inputfield {
            width: 100%;
            padding-right: 40px;
        }


        .ui-inputfield {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: "FreightText Pro", serif;
            font-size: 1em;
        }

        .ui-selectonemenu {
            width: 100% !important;
        }

        .ui-selectonemenu-label {
            padding: 8px 12px !important;
            font-family: "FreightText Pro", serif !important;
        }
    </style>
</h:head>

<h:body>
    <div class="topbar">
        <div class="topbar-left">
            <img src="resources/edicion.png" alt="Empleados" class="topbar-icon" />
            <a href="AdminEmpleados.xhtml">Empleados</a>
        </div>
        <div class="topbar-center">
            <a href="principalAdministrador.xhtml">EVENTOS CAMPESTRE</a><br />
            <a href="TarjetaAlmacen.xhtml">Inventario</a>
            <a href="Articulos.xhtml">Artículos</a>
            <a href="Cotizaciones.xhtml">Cotizaciones</a>
            <a href="Rentas.xhtml">Rentas</a>
            <a href="Dashboard.xhtml">Informes</a>
            <a href="CombinacionMesa.xhtml">Combinacion de mesas</a>
        </div>
        <div class="topbar-right">
            <span>Administrador</span>
            <img src="resources/administrador.png" alt="admin" class="topbar-icon" />
        </div>
    </div>

    <div class="content">
        <h1 class="title">Tarjeta de Almacen - Control de Movimientos</h1>

        <p:messages id="messages" showDetail="true" closable="true" />

        <h:form id="formFiltros">
            <div class="filter-panel">
                <h3 style="margin-top: 0;">Parametros de Consulta</h3>

                <p:outputPanel id="panelToggle" styleClass="toggle-buttons">
                    <p:commandButton value="Consulta por Dia"
                                     styleClass="btn"
                                     action="#{tarjetaAlmacenUI.activarConsultaPorDia()}"
                                     update="panelToggle,panelFechas,panelBotones"
                                     disabled="#{!tarjetaAlmacenUI.consultaPorRango}" />
                    <p:commandButton value="Consulta por Rango"
                                     styleClass="btn"
                                     action="#{tarjetaAlmacenUI.activarConsultaPorRango()}"
                                     update="panelToggle,panelFechas,panelBotones"
                                     disabled="#{tarjetaAlmacenUI.consultaPorRango}" />
                </p:outputPanel>

                <div class="filter-row">
                    <div class="filter-field">
                        <label for="articulo">Articulo:</label>
                        <p:selectOneMenu id="articulo"
                                         value="#{tarjetaAlmacenUI.articuloSeleccionadoId}">
                            <f:selectItem itemLabel="-- Seleccione --" itemValue="#{null}" />
                            <f:selectItems value="#{tarjetaAlmacenUI.articulos}"
                                           var="art"
                                           itemLabel="#{art.nombre}"
                                           itemValue="#{art.id}" />
                        </p:selectOneMenu>
                    </div>

                    <p:outputPanel id="panelFechas" layout="block" styleClass="filter-row-inline">
                        <h:panelGroup rendered="#{!tarjetaAlmacenUI.consultaPorRango}">
                            <div class="filter-field">
                                <label for="fecha">Fecha:</label>
                                <p:datePicker id="fecha"
                                              value="#{tarjetaAlmacenUI.fechaConsulta}"
                                              pattern="dd/MM/yyyy"
                                              showIcon="true"
                                              locale="es"
                                              readonlyInput="true"
                                              placeholder="Selecciona una fecha" />
                            </div>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{tarjetaAlmacenUI.consultaPorRango}">
                            <div class="filter-field">
                                <label for="fechaInicio">Fecha Inicio:</label>
                                <p:datePicker id="fechaInicio"
                                              value="#{tarjetaAlmacenUI.fechaInicio}"
                                              pattern="dd/MM/yyyy"
                                              showIcon="true"
                                              locale="es"
                                              readonlyInput="true"
                                              placeholder="Selecciona fecha inicio" />
                            </div>

                            <div class="filter-field">
                                <label for="fechaFin">Fecha Fin:</label>
                                <p:datePicker id="fechaFin"
                                              value="#{tarjetaAlmacenUI.fechaFin}"
                                              pattern="dd/MM/yyyy"
                                              showIcon="true"
                                              locale="es"
                                              readonlyInput="true"
                                              placeholder="Selecciona fecha fin" />
                            </div>
                        </h:panelGroup>
                    </p:outputPanel>
                </div>

                <p:outputPanel id="panelBotones" layout="block" styleClass="filter-row">
                    <p:commandButton value="Generar Tarjeta"
                                     styleClass="btn"
                                     action="#{tarjetaAlmacenUI.generarTarjetaDia()}"
                                     update="formTarjeta,messages"
                                     rendered="#{!tarjetaAlmacenUI.consultaPorRango}" />
                    <p:commandButton value="Generar Tarjeta"
                                     styleClass="btn"
                                     action="#{tarjetaAlmacenUI.generarTarjetaRango()}"
                                     update="formTarjeta,messages"
                                     rendered="#{tarjetaAlmacenUI.consultaPorRango}" />
                    <p:commandButton value="Limpiar"
                                     styleClass="btn"
                                     action="#{tarjetaAlmacenUI.limpiarConsulta()}"
                                     update="formFiltros,formTarjeta,messages" />
                </p:outputPanel>
            </div>
        </h:form>

        <h:form id="formTarjeta">
            <h:panelGroup rendered="#{not empty tarjetaAlmacenUI.tarjetaDelDia}">
                <div class="tarjeta-header">
                    <h3>#{tarjetaAlmacenUI.nombreArticuloSeleccionado}</h3>
                </div>

                <div class="table-container">
                    <h:dataTable value="#{tarjetaAlmacenUI.tarjetaDelDia}"
                                 var="fila"
                                 styleClass="tarjeta-table">

                        <h:column>
                            <f:facet name="header">Fecha</f:facet>
                            <h:outputText value="#{fila.fechaFormateada}" />
                        </h:column>

                        <h:column>
                            <f:facet name="header">Movimiento</f:facet>
                            <h:outputText value="Renta ##{fila.idRenta}"
                                          rendered="#{fila.idRenta != null}" />
                            <h:outputText value="-"
                                          rendered="#{fila.idRenta == null}" />
                        </h:column>

                        <h:column>
                            <f:facet name="header">Concepto</f:facet>
                            <h:outputText value="#{fila.concepto}" />
                        </h:column>

                        <h:column>
                            <f:facet name="header">Inventario Inicial</f:facet>
                            <h:outputText value="#{fila.inventarioInicial}" />
                        </h:column>

                        <h:column>
                            <f:facet name="header">Entrada</f:facet>
                            <h:outputText value="#{fila.entrada}"
                                          styleClass="#{fila.entrada > 0 ? 'amount-positive' : ''}" />
                        </h:column>

                        <h:column>
                            <f:facet name="header">Salida</f:facet>
                            <h:outputText value="#{fila.salida}"
                                          styleClass="#{fila.salida > 0 ? 'amount-negative' : ''}" />
                        </h:column>

                        <h:column>
                            <f:facet name="header">Existencia</f:facet>
                            <h:outputText value="#{fila.existencia}" />
                        </h:column>

                        <h:column>
                            <f:facet name="header">Debe</f:facet>
                            <h:outputText value="#{fila.debe}"
                                          styleClass="#{fila.debePositivo ? 'amount-positive' : ''}">
                                <f:convertNumber type="currency" currencySymbol="$" />
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Haber</f:facet>
                            <h:outputText value="#{fila.haber}"
                                          styleClass="#{fila.haberPositivo ? 'amount-negative' : ''}">
                                <f:convertNumber type="currency" currencySymbol="$" />
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Saldo</f:facet>
                            <h:outputText value="#{fila.saldo}">
                                <f:convertNumber type="currency" currencySymbol="$" />
                            </h:outputText>
                        </h:column>
                    </h:dataTable>
                </div>
            </h:panelGroup>

            <h:panelGroup rendered="#{empty tarjetaAlmacenUI.tarjetaDelDia}">
                <div class="empty-table-message">
                    <p style="margin: 0; font-size: 1.1em;">Seleccione un artículo y una fecha para generar la tarjeta de almacén</p>
                </div>
            </h:panelGroup>
        </h:form>
    </div>
</h:body>
</html>